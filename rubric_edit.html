<!DOCTYPE html>
<!-- saved from url=(0043)http://getbootstrap.com/examples/jumbotron/ -->
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description" content=""/>
		<meta name="author" content=""/>
		<link rel="shortcut icon" href="img/favicon.png"/>

		<title>Rubricon</title>
		<link href="css/bootstrap.min.css" rel="stylesheet"/>
		<link href="css/bootstrap-theme.min.css" rel="stylesheet"/>
		<link href="css/bootstrap-slider.css" rel="stylesheet"/>
		<link href="styles.css" rel="stylesheet"/>
		<script src="./js/jquery.min.js"></script>
		
		<style>[touch-action="none"]{ -ms-touch-action: none; touch-action: none; }[touch-action="pan-x"]{ -ms-touch-action: pan-x; touch-action: pan-x; }[touch-action="pan-y"]{ -ms-touch-action: pan-y; touch-action: pan-y; }[touch-action="scroll"],[touch-action="pan-x pan-y"],[touch-action="pan-y pan-x"]{ -ms-touch-action: pan-x pan-y; touch-action: pan-x pan-y; }</style>
		<script>
			$(document).ready(function() {
				//bind the onblur on inputs so the values are restored
				$.ajax({
					url: "project_get_list.php",
					cache: false,
					success: function(html){
						$("#projects_list").append(html);
					}
				});
			});
			function getProjectData(projId){
				if(projId > 0){
					//alert(projId);
					$.ajax({
						type: "POST",
						url: "project_get_detail.php",
						cache: false,
						data: {'ID': projId},
						dataType: "xml",
						success: function(xml) {
							console.log(xml);
							$(xml).find('projects').each(function(){
								//var nName = this.nodeName;
								//alert("Node Name = " + nName);
								var proj = $(this).find("project").text();
								$('#project').val(proj);
								var proj_details = $(this).find("project_details").text()
								$('#p_details').val(proj_details);
							});
						},
						error: function(xhr, textStatus, error){
							console.log(xhr.statusText);
							console.log(textStatus);
							console.log(error);
						}
					});
				} 
			}
			
			function saveRubricData(projId){
				//var str = $("form").serialize();
				//Get values from added textareas
				var numItems = $('.rubric').length;
				var rStr = "";
				for(var i = numItems; i > 0; i--){
        //for(var i = 1; i < numItems + 1; i++){
          var rText = $('#ta' + parseInt(i)).val();
          var rLevel = parseInt(i);
  				$.ajax({
  					url: "rubric_edit.php",
  					cache: false,
  					type: 'POST',
  					data:{project_id: projId, r_level: rLevel, r_text: rText},
  					success: function(resp) {
  						if(resp.indexOf("error") > -1){
  							msg = resp.replace("error","");																						
  						} else {
  							msg = "Project Rubric details updated!";
  						}
  					},
  					error: function(xhr, textStatus, error){
  						displayMessage("Error saving data: " + error ); 
  					}
  				});
			  }
				displayMessage(msg);
				$.ajax({
					url: "",
					context: document.body,
					success: function(s,x){
						$(this).html(s);
					}
				});				
			  
			}

			function displayMessage(msg){
				BootstrapDialog.show({
					title:"Rubricon",
					size: BootstrapDialog.SIZE_NORMAL,
					cssClass: 'login-dialog',
					message: msg,
					draggable: true,
					buttons: [{
						label: 'Close',
						action: function(dialogItself){
							dialogItself.close();
						}
					}]
				});
			}
			
		</script>
	</head>
	<body>
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse"/>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="index.html">Rubricon</a>
				</div>
				<div class="navbar-collapse collapse" style="height: 1px;">
					<ul class="nav navbar-nav">
						<li><a href="index.html">Home</a></li>
						<li class="active"><a href="register.html">Register</a></li>
						<li><a href="login.html">Log In</a></li>
						<li><a href="sports_select.html">Projects</a></li>
					</ul>
				</div><!--/.navbar-collapse -->
			</div>
		</div>

		<div id="container">
			<div class="row">
				<h2>Edit Rubric Details</h2>
				<form id="projectedit" name="projectedit" role="form" class="form-horizontal">
					<div class="col-md-6 col-md-offset-1">
						<div class="form-group">
							<label for="projects_list" class="col-lg-4 control-label">Select Project</label>
							<select id="projects_list" class="form-control" name="projects_list" class="col-lg-8" onchange="getProjectData($('#projects_list').find(':selected').val())">
								<option value="0">Select project...</option>
							</select>
						</div>
						<div class="form-group">
							<label for="project" class="col-lg-4 control-label">Project:</label>
							<input type="text" name="project" id="project" placeholder="Project Name" class="form-control" size="20" class="col-lg-8">
						</div>
						<div class="form-group">
							<label for="p_details" class="col-lg-4 control-label">Project Details:</label>
							<textarea id="p_details" name="p_details" class="form-control" rows="3" class="col-lg-8"></textarea>
						</div>
					</div>
				</form>
			</div>
			<hr/>
			<!--=================================================================-->
    <div class="row">
      <div class="col-lg-4 col-lg-offset-2">
        <label for="taskCnt">Tasks</label><br/>
        <input type="number" id="taskCnt" class="form-control" min="1" max="25" value="1"/>
      </div>
    </div>

    <div class="row margin-top-md">
      <div class="col-lg-4 col-lg-offset-2">
        <label for="rubCnt">Rubric Grades (1-5)</label><br/>
        <input type="number" id="rubCnt" class="form-control" min="1" max="5" value="1"/>
      </div>
    </div>

    <div class="row margin-top-md" id="main">
      <div class="col-lg-8 col-xs-6 col-md-offset-3">
        <input type="button" id="btAdd" value="Add Elements" class="bt btn-success" />
        <input type="button" id="btRemove" value="Remove Element" class="bt btn-warning" />
        <input type="button" id="btRemoveAll" value="Remove All" class="bt btn-danger" />
      </div>
      
      <hr/>
      
      <div id="ta_container" class="container"></div>
    </div>
    
		<div class="row margin-top-md">
			<div class="col-xs-12 col-md-6 col-md-offset-3">
				<a href="#" onclick="saveRubricData($('#projects_list').find(':selected').val());" class="btn btn-success btn-primary">Save Project Rubric</a>
				<a href="#" onclick="deleteRubricData($('#projects_list').find(':selected').val());" class="btn btn-warning">Delete Project</a>	
			</div>
		</div>
    
			<!--=================================================================-->
			<hr/>
			<footer>
				<p>&copy; STEM Cell 2015</p>
			</footer>			
		</div>
		<script src="./js/jquery.min.js"></script>
		<script src="./js/jquery-ui.js"></script>
		<script src="./js/bootstrap.min.js"></script>
		<script src="./js/bootstrap-dialog.min.js"></script>

		<script>
			$( document ).ready(function() {
        /* Add dynamic controls */
        var iCnt = 0;
        var row = $("#ta_container").append("div").addClass("row");
        $(row).attr('id', 'rubrow');

        $('#btAdd').click(function() {
          if(iCnt > 0){
            removeAll();
          }
          iCnt = 0;
          var rubCnt = $("#rubCnt").val();
          for(var i = 0; i < rubCnt; i++){
            iCnt = iCnt + 1;
            var col = $(document.createElement('div'));
            $(col).attr('id', 'rub' + iCnt);
            col.addClass("col-xs-4 col-md-2 col-lg-2 margin-left-md");
            $(col).append('h3').text("Rubric Level Description " + parseInt(rubCnt - i));
            $(col).append('<textarea class="form-control rubric" rows="3" id="ta' + parseInt(rubCnt - i) + '" />');
            $("#rubrow").after(col);
          }
        });

        $('#btRemove').click(function() {   // REMOVE ELEMENTS ONE PER CLICK.
            if (iCnt !== 0) { 
              $('#rub' + iCnt).remove(); 
              iCnt = iCnt - 1; 
            }
        });

        $('#btRemoveAll').click(function() {    // REMOVE ALL THE ELEMENTS IN THE CONTAINER.
          removeAll();
        });
        
        function removeAll(){
            var numItems = $('.rubric').length;
            while(numItems > 0){
              $('#rub' + numItems).remove();
              numItems = $('.rubric').length;
            }  
            iCnt = 0;
        }
    });

		</script>
	</body>
</html>